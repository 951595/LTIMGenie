
name: Java CI with Maven
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven
    - name: Build with Maven
      run: mvn -B install --file pom.xml
    - uses: actions/upload-artifact@v4
      with:
        name: Artifacts
        path: target/*.jar
    
    - uses: Azure/docker-login@v1
      with:
        login-server: devacrdemo123.azurecr.io         #ltimacrdemo.azurecr.io
        username: ${{ secrets.REGISTRY_USERNAME }}      #LTIMacrdemo 
        password: ${{ secrets.REGISTRY_PASSWORD }}       #PtYZhec7Ph0P9tB/5d8R+VFfWVKmzTE0DZRvUTCWjL+ACRCqGTlR 
          
    - run: |
         docker build . -t devacrdemo123.azurecr.io/githubaction-repo:latest
         docker push devacrdemo123.azurecr.io/githubaction-repo:latest

    # - uses: azure/setup-kubectl@v2.0

    #      # Set the target AKS cluster.
    # - uses: Azure/aks-set-context@v1
    #   with:
    #      creds: '${{ secrets.AZURE_CREDENTIALS }}'
    #      cluster-name: contoso
    #      resource-group: contoso-rg

    # - uses: Azure/k8s-create-secret@v1.1
    #   with:
    #      container-registry-url: contoso.azurecr.io
    #      container-registry-username: ${{ secrets.REGISTRY_USERNAME }}
    #      container-registry-password: ${{ secrets.REGISTRY_PASSWORD }}
    #      secret-name: demo-k8s-secret

    # - uses: Azure/k8s-deploy@v4
    #   with:
    #      action: deploy
    #      manifests: |
    #         manifests/deployment.yml
    #         manifests/service.yml
    #      images: |
    #         demo.azurecr.io/k8sdemo:${{ github.sha }}
    #      imagepullsecrets: |
    #         demo-k8s-secret
